<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìö –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ —Å –∫–Ω–∏–≥–∏</title>
</head>
<body>
<header>
    <h1>üìö –ú–æ—è—Ç–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞</h1>
    <p>–£–ø—Ä–∞–≤–ª—è–≤–∞–π —Å–≤–æ–∏—Ç–µ –∫–Ω–∏–≥–∏ –ª–µ—Å–Ω–æ –∏ –±—ä—Ä–∑–æ</p>
</header>

<main>
    <section>
        <h2>‚ûï –î–æ–±–∞–≤–∏ –Ω–æ–≤–∞ –∫–Ω–∏–≥–∞</h2>
        <form onsubmit="event.preventDefault(); addBook();">
            <div>
                <label for="title">–ó–∞–≥–ª–∞–≤–∏–µ:</label>
                <input type="text" id="title" placeholder="–í—ä–≤–µ–¥–∏ –∑–∞–≥–ª–∞–≤–∏–µ –Ω–∞ –∫–Ω–∏–≥–∞—Ç–∞" required>
            </div>

            <div>
                <label for="author">–ê–≤—Ç–æ—Ä:</label>
                <input type="text" id="author" placeholder="–í—ä–≤–µ–¥–∏ –∞–≤—Ç–æ—Ä" required>
            </div>

            <div>
                <label for="year">–ì–æ–¥–∏–Ω–∞ –Ω–∞ –ø—É–±–ª–∏–∫—É–≤–∞–Ω–µ:</label>
                <input type="number" id="year" placeholder="–ù–∞–ø—Ä. 2024">
            </div>

            <div>
                <label for="isbn">ISBN:</label>
                <input type="text" id="isbn" placeholder="ISBN –Ω–æ–º–µ—Ä">
            </div>

            <button type="submit">‚úÖ –î–æ–±–∞–≤–∏ –∫–Ω–∏–≥–∞</button>
        </form>
    </section>

    <section>
        <h2>üìñ –í—Å–∏—á–∫–∏ –∫–Ω–∏–≥–∏</h2>
        <button onclick="loadBooks()">üîÑ –ü—Ä–µ–∑–∞—Ä–µ–¥–∏ –∫–Ω–∏–≥–∏—Ç–µ</button>
        <div id="booksList">
            <p>–ó–∞—Ä–µ–∂–¥–∞–º –∫–Ω–∏–≥–∏—Ç–µ...</p>
        </div>
    </section>
</main>

<footer>
    <p>¬© 2024 –ú–æ—è—Ç–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞. –í—Å–∏—á–∫–∏ –ø—Ä–∞–≤–∞ –∑–∞–ø–∞–∑–µ–Ω–∏.</p>
</footer>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        loadBooks();
    });

    async function loadBooks() {
        try {
            const response = await fetch('/api/books');
            const books = await response.json();
            displayBooks(books);
        } catch (error) {
            console.error('–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ –∫–Ω–∏–≥–∏—Ç–µ:', error);
            document.getElementById('booksList').innerHTML = '<p>‚ùå –ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ –∫–Ω–∏–≥–∏—Ç–µ</p>';
        }
    }

    // –§—É–Ω–∫—Ü–∏—è –∑–∞ –ø–æ–∫–∞–∑–≤–∞–Ω–µ –Ω–∞ –∫–Ω–∏–≥–∏—Ç–µ
    function displayBooks(books) {
        const booksList = document.getElementById('booksList');

        if (books.length === 0) {
            booksList.innerHTML = '<p>üì≠ –í—Å–µ –æ—â–µ –Ω—è–º–∞ –∫–Ω–∏–≥–∏ –≤ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞—Ç–∞</p>';
            return;
        }

        booksList.innerHTML = books.map(book => `
            <div style="border: 1px solid #ccc; padding: 15px; margin: 10px 0; background: #f9f9f9;">
                <div style="font-size: 18px; font-weight: bold;">${book.title}</div>
                <div style="color: #666;">‚úçÔ∏è ${book.author}</div>
                <div>üìÖ –ì–æ–¥–∏–Ω–∞: ${book.publicationYear}</div>
                <div>üîñ ISBN: ${book.isbn}</div>
                <button onclick="deleteBook(${book.id})" style="background: red; color: white; padding: 5px 10px; border: none; margin-top: 10px;">‚ùå –ò–∑—Ç—Ä–∏–π</button>
            </div>
        `).join('');
    }

    // –§—É–Ω–∫—Ü–∏—è –∑–∞ –¥–æ–±–∞–≤—è–Ω–µ –Ω–∞ –Ω–æ–≤–∞ –∫–Ω–∏–≥–∞
    async function addBook() {
        const title = document.getElementById('title').value;
        const author = document.getElementById('author').value;
        const year = document.getElementById('year').value;
        const isbn = document.getElementById('isbn').value;

        if (!title || !author) {
            alert('‚ùå –ú–æ–ª—è, –ø–æ–ø—ä–ª–Ω–∏ –ø–æ–Ω–µ –∑–∞–≥–ª–∞–≤–∏–µ –∏ –∞–≤—Ç–æ—Ä!');
            return;
        }

        const newBook = {
            title: title,
            author: author,
            publicationYear: parseInt(year) || new Date().getFullYear(),
            isbn: isbn || '–ù—è–º–∞ ISBN'
        };

        try {
            await fetch('/api/books', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(newBook)
            });

            // –ò–∑—á–∏—Å—Ç–∏ —Ñ–æ—Ä–º–∞—Ç–∞
            document.getElementById('title').value = '';
            document.getElementById('author').value = '';
            document.getElementById('year').value = '';
            document.getElementById('isbn').value = '';

            // –ü—Ä–µ–∑–∞—Ä–µ–¥–∏ –∫–Ω–∏–≥–∏—Ç–µ
            loadBooks();

        } catch (error) {
            console.error('–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤—è–Ω–µ –Ω–∞ –∫–Ω–∏–≥–∞:', error);
            alert('‚ùå –ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤—è–Ω–µ –Ω–∞ –∫–Ω–∏–≥–∞—Ç–∞');
        }
    }

    // –§—É–Ω–∫—Ü–∏—è –∑–∞ –∏–∑—Ç—Ä–∏–≤–∞–Ω–µ –Ω–∞ –∫–Ω–∏–≥–∞
    async function deleteBook(bookId) {
        if (!confirm('‚ö†Ô∏è –°–∏–≥—É—Ä–µ–Ω –ª–∏ —Å–∏, —á–µ –∏—Å–∫–∞—à –¥–∞ –∏–∑—Ç—Ä–∏–µ—à —Ç–∞–∑–∏ –∫–Ω–∏–≥–∞?')) {
            return;
        }

        try {
            await fetch(`/api/books/${bookId}`, {
                method: 'DELETE'
            });

            loadBooks(); // –ü—Ä–µ–∑–∞—Ä–µ–¥–∏ —Å–ø–∏—Å—ä–∫–∞
        } catch (error) {
            console.error('–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∏–∑—Ç—Ä–∏–≤–∞–Ω–µ –Ω–∞ –∫–Ω–∏–≥–∞:', error);
            alert('‚ùå –ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∏–∑—Ç—Ä–∏–≤–∞–Ω–µ –Ω–∞ –∫–Ω–∏–≥–∞—Ç–∞');
        }
    }
</script>
</body>
</html>